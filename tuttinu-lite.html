<!DOCTYPE html> <!-- tells browser we're using HTML -->
<html lang="en"> <!-- starts HTML document, english -->
<head> <!-- contains meta information (not shown) -->

  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet"> <!-- imports Poppins font -->
  <link href="https://fonts.googleapis.com/css2?family=Karla&display=swap" rel="stylesheet"> <!-- imports Karla font -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"> <!-- imports icons -->

  <meta charset="UTF-8" /> <!-- character encoding -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <!-- sets page width to width of device, zoom level to 100% -->
  
  <link rel="icon" type="image/png" href="favicon.png" /> <!-- sets tab icon -->
  <title>Tutti NU Lite</title> <!-- sets tab title -->

  <style> /* block of internal CSS */

    html { scroll-behavior: smooth; }

    footer p { color: #000000; font-size: 12px; font-family: 'Karla'; text-align: left; margin: 0 1.5%; }
    h1 { color: #000000; font-size: 36px; font-family: 'Poppins'; text-align: center; margin-top: 200px; }
    h2 { color: #000000; font-size: 18px; font-family: 'Poppins'; margin: 10px 10px; }

    .line { width: 97%; height: 2px; background-color: black; margin: 5px auto; }
    .back-button { position: fixed; top: 20px; left: 20px; z-index: 1000;display: inline-block; margin: 20px; padding: 10px 16px; font-family: Karla, sans-serif; font-size: 16px; color: #000; background-color: #e8e8e8; text-decoration: none; border-radius: 8px; border: none; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: background-color 0.3s ease; }
    .signin-button { display: inline-block; margin: 20px; padding: 10px 16px; font-family: Karla, sans-serif; font-size: 16px; color: #000; background-color: #e8e8e8; text-decoration: none; border-radius: 8px; border: none; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: background-color 0.3s ease; }
    .back-button:hover { background-color: #d6d6d6; }

    @media (max-width: 768px) { /* styling that overrides when screen is 768px wide or smaller */
    footer p { font-size: 10px; margin: 0 2%;}
    h1 { font-size: 26px; }
    h2 { font-size: 10px; }
    .line { width: 96%; } 
    .back-button {margin: 12px; padding: 7.5px 12px; font-size: 13px;}}

  </style>
</head>

<body> <!-- begins visible page content -->

  <a href="projects.html" class="back-button">← Back</a>
  <h1>Tutti NU Lite ♪</h1>

  <header> <!-- intro-related content -->
  </header>

<main>
  <div style="display: flex; justify-content: center; margin-top: -10px;">
    <button onclick="signInWithGoogle()" class="signin-button" style="display: flex; align-items: center; padding: 12px 3%; ">
      <i class="fab fa-google" style="font-size: 16px; margin-right: 4px;"></i>
      Sign in with Google
    </button>
  </div>
</main>

  <footer> <!-- closing-related content -->
  <div class="line" style="height: 1px; margin-top: 600px;"></div>
  <p>Website created by Hannah Webb</p>
  </footer>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithRedirect, getRedirectResult, signOut } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";

  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDKHRcyCqoEZsqYYlPn27eyNtiNaU5xh-4",
    authDomain: "tutti-nu-lite.firebaseapp.com",
    projectId: "tutti-nu-lite",
    storageBucket: "tutti-nu-lite.appspot.com",
    messagingSenderId: "941649168233",
    appId: "1:941649168233:web:79617ad29fb63f35a39ff8",
    measurementId: "G-CFW9LH4SCM"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  // Function to call on button click
  // On click, start redirect-based sign-in
window.signInWithGoogle = () => {
  signInWithRedirect(auth, provider);
};

// Handle redirect result when page loads
window.addEventListener("load", () => {
  getRedirectResult(auth)
    .then((result) => {
      if (result && result.user) {
        const user = result.user;
        const email = user.email;

        // Check if email is a Northwestern email
        if (email.endsWith("@u.northwestern.edu") || email.endsWith("@northwestern.edu")) {
          console.log("Signed in as:", email);
          alert("Welcome, " + user.displayName);

          // Redirect to dashboard after successful login
          window.location.href = "tutti-nu-lite-dashboard.html";
        } else {
          alert("Please use a Northwestern email.");
          signOut(auth); // Sign out if wrong domain
        }
      } else {
        console.log("No redirect result.");
      }
    })
    .catch((error) => {
      console.error("Sign-in error:", error.code, error.message);
    });
});

</script>

</body> <!-- ends visible page content -->
</html>